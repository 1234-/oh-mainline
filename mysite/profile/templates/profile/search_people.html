{% extends 'base/one_column.html' %}

{% block title %}
People
{% endblock title %}

{% block css %}
{{ block.super }}
@import url('/static/css/profile/search_people.css');
{% endblock css %}

{% block main %}
<img alt='People on OpenHatch' id='people-search' alt='People on OpenHatch' src='/static/images/people-search.png' />
<div id='big-people-list' class='module'>
    <div class='module-content body'>
        {% if property and value %}
        where {{ property }} = {{ value }}
        {% endif %}
	<div id="map_canvas" style="width:100%; height:450px"></div>
        <ul>
            {% for person in people %}
            {% if person.user.username %}
            <li>
            <a href='/people/{{person.user.username}}'>
                {% if person.user.first_name or person.user.last_name %}
                {{ person.user.first_name }} {{ person.user.last_name }} ({{ person.user.username }})
                {% else %}
                {{ person.user.username }}
                {% endif %}
            </a>
            </li>
            {% endif %}
            {% endfor %}
        </ul>
    </div>
</div>
{% endblock main %}

{% block js_in_head %}
<script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script>
<script type="text/javascript">

  var people2location_name = {{ people2location_name_as_json|safe}};

  function initialize() {

  var geocoder =  new google.maps.Geocoder();

    var latlng = new google.maps.LatLng(-34.397, 150.644);
    var myOptions = {
      zoom: 8,
      center: latlng,
      mapTypeId: google.maps.MapTypeId.ROADMAP
    };
    var map = new google.maps.Map(document.getElementById("map_canvas"), myOptions);

    for (var person_name in people2location_name) {
      var location_name = people2location_name[person_name];
      
      function create_a_callback(person_name) {
	return function(results, status) {
	  if (status == google.maps.GeocoderStatus.OK) {
	    map.setCenter(results[0].geometry.location);
	    var marker = new google.maps.Marker({
	      map: map, 
		  title: person_name,
		  position: results[0].geometry.location
		  });
	  } else {
	    console.log("Geocode was not successful for the following reason: " + status);
	  }
	}
      };

      geocoder.geocode( { 'address': location_name}, create_a_callback(person_name));
    
    }
}
</script>
{% endblock js_in_head %}

{% block js %}
<script type="text/javascript">
{{ block.super }}
$(initialize);
</script>
{% endblock js %}
