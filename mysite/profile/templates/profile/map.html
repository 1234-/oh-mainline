{% extends 'profile/people.html' %}

{% block title %}
Map of People
{% endblock title %}

{% block people_main %}
        {% if property and value %}
        where {{ property }} = {{ value }}
        {% endif %}
        <div id="map_canvas" style="float: left; margin-right: 10px; width:70%; height:450px;
                background-image: url('/static/images/profile/map_for_loading.png');
                text-align: center;">
            <div class='map_loading_msg' style='margin-left: 20%; padding: 8px; margin-top: 150px; width: 60%; background-color: #fff;'>
                <img src='/static/images/icons/throbber.png' style=' height: 2.5em;'/>
                <span style='font-size: 2.5em; margin-left: 10px; '>Loading map&hellip;</span>
            </div>
        </div>
        <ul id="people-list" style='float: left; width: 20%;'>
            {% for person in people %}
                {% if person.user.username %}
                    <li id="person_bullet_{{person.pk}}" style="display: none;">
                        <a href='/people/{{person.user.username}}'>
                            <img src="{{ person.get_photo_thumbnail_url_or_default }}" />
                        </a>
                            <div class="people-view-info">
                            <a class="name">
                            {% if person.user.first_name or person.user.last_name %}
                                {{ person.user.first_name }} {{ person.user.last_name }}
                                ({{ person.user.username }})
                            {% else %}
                                {{ person.user.username }}
                            {% endif %}
                        </a>
                        {% if person.location_display_name %}
                        <span class="location">
                            {{ person.location_display_name }}
                        </span>
                        {% endif %}
                        {% with person.get_list_of_project_names as project_names%}
                        {% if project_names %}
                        <span class="people-view-projects">
                            projects: 
                            {% for project in project_names %}
                            {{ project }}{% if not forloop.last %}, {% endif %}

                            {% endfor %}


                        </span>
                        {% endif %}
                        {% endwith %}
                            {% with person.get_tag_texts_for_map as tags %}
                            {% if tags %}
                            <span class="people-view-tags">
                                tags: 
                            {% for tag in tags %}
                            {{ tag }}{% if not forloop.last %}, {% endif %}

                            {% endfor %}
                            </span>
                            {% endif %}
                            {% endwith %}
                            </div>
                    </li>
                {% endif %}
            {% endfor %}
        </ul>
        {% endblock people_main %}

{% block js_before_bundle %}
<script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script>
{% endblock js_before_bundle %}

{% block js %}
{{ block.super }}
<script type="text/javascript">
    $(function () {
        var map = new PeopleMap(); 
        map.initialize({
                'person_id2data': {{ person_id2data_as_json|safe}},
                'num_of_persons_with_locations': {{ num_of_persons_with_locations }}
        });
    });
</script>
{% endblock js %}
