{% extends 'base/base.html' %}
{% load base_extras %}
{% load profile_extras %}

{% block title %}
Home
{% endblock title %}

{% block body_id %}landing{% endblock body_id %}

{% block css %}
{{ block.super }}
body#landing #welcome { float: left; width: 100%; }
body#landing .column { float: left; width: 44%; margin-right: 0; margin-left: 2%; }
body#landing .column:first-child { width: 32%; margin-left: 0; }
body#landing .column:last-child { width: 20%; }
body#landing .module .body { background: #fff; padding: 3%; width: 94%; }
body#landing .module .head { width: 98%; }
body#landing .module { width: 100%; }
body#landing #right .body { padding: 5%; }
body#landing #right .body { width: 90%; }
body#landing #bugs li { margin-top: 10px; }
{% endblock css %}

{% block pagetop %}
<div class='module' id='welcome'>
    <div class='body'>
        <ul id='people-list'>
            {% with the_user.get_profile as person %}
                {% include 'profile/person-summary-li.html' %}
            {% endwith %}
        </ul>
    </div>
</div>
{% endblock %}

{% block content %}

<div id='left' class='column'>

{% if the_user.is_authenticated %}
<div class='module' id='me'>
    <div class='head'>
        <h3>You</h3>
    </div>
    <div class='body'>
        <ul id='people-list'>
            {% with the_user.get_profile as person %}
                {% include 'profile/person-summary-li.html' %}
            {% endwith %}
        </ul>
    </div>
</div>

{% with the_user.get_profile.get_collaborators_for_landing_page as collaborators %}
<div class='module' id='people'>
    <div class='head'>
        {% if collaborators %}
        <h3>Collaborators</h3>
        {% else %}
        <h3>Five random profiles</h3>
        {% endif %}
    </div>
    <div class='body'>
        <ul id='people-list'>
            {% if collaborators %}
                {% for person in collaborators %}
                    {% include 'profile/person-summary-li.html' %}
                {% endfor %}
            {% else %}
                {% for person in random_profiles %}
                    {% include 'profile/person-summary-li.html' %}
                {% endfor %}
            {% endif %}
        </ul>
    </div>
</div>
{% endwith %}

{% else %}
<div class='module' id='people'>
    <div class='head'>
        <h3>People on OpenHatch</h3>
    </div>
    <div class='body'>
        <ul id='people-list'>
            {% for person in random_profiles %}
                {% include 'profile/person-summary-li.html' %}
            {% endfor %}
        </ul>
    </div>
</div>
{% endif %}

</div>

<div id='middle' class='column'>
    <div class='module' id='todo'>
        <div class='head'>
            <h3>Things to do around here</h3>
        </div>
        <div class='body'>
            <ul class='nudgebuttons'></strong></strong></strong>
                {% if the_user.is_authenticated %}
                    <li>
                        <a href=''>
                            <div class='notification smaller'>
                                <span class='arrow'>&rarr;</span>
                                <strong>Add a location</strong>
                                and find FLOSS supporters near you
                            </div>
                        </a>
                    </li>
                    <li>
                        <a href=''>
                            <div class='notification smaller'>
                                <span class='arrow'>&rarr;</span>
                                <strong>Build your portfolio</strong>
                                using our mind-bending data-slurping tool
                            </div>
                        </a>
                    </li>
                    <li>
                        <a href=''>
                            <div class='notification smaller'>
                                <span class='arrow'>&rarr;</span>
                                <strong>Add interests</strong>
                                and we'll recommend cool projects and people to check out
                            </div>
                        </a>
                    </li>
                {% else %}
                {# User is browsing anonymously #}
                <li>
                    <a href=''>
                        <div class='notification smaller'>
                            <span class='arrow'>&rarr;</span>
                            <strong>Create a profile</strong>
                            Tell us what you hack on, and what you're all about. Then we can recommend interesting projects and volunteering opportunities for you.
                        </div>
                    </a>
                </li>
                {% endif %}
            </ul>
        </div>
    </div>

    <div class='module' id='bugs'>
        <div class='head'>
        {% if recommended_bugs %}
            <h3>Recommended bugs</h3>
            <span class='note'>based on your profile</span>
        {% else %}
            <h3>Popular bug categories</h3>
        {% endif %}
        </div>
        <div class='body'>
            {% if recommended_bugs %}
            <ul>
                {% for bug in recommended_bugs %}
                <li style="list-style-image: url('{{ bug.project.get_url_of_search_result_icon_or_generic }}');">
                <span>
                    <a style='font-weight: bold;'
                        href='{{ bug.canonical_bug_link }}'>
                        {{ bug.title }}</a>
                    in&nbsp;{{ bug.project.name }}
                    {% if bug.project.language %}
                    (project&nbsp;language:&nbsp;{{ bug.project.language }})
                    {% endif %}
                </span></li>
                {% endfor %}
            </ul>
            <p><a href='/search/' style='float: right;'>Find more opportunities <strong>&raquo;</strong></a></p>
            {% else %}
            Discover new ways that you can contribute to free and open source software.
        {# If no recommended bugs: #}
        <style type='text/css'>
            #bugs ul { list-style: none; }
            #bugs li { }
        </style>
            <ul>
            {% comment %}
            {% for category in popular_bug_categories %}
                <li><a href='{{ category.url }}'>{{ category.name }}</a></li>
            {% endfor %}
            {% endcomment %}
            <li><a href='#'><strong> Bitesize </strong> bugs whose main project language is <strong> Python </strong> (137)</a></li>
            <li><a href='#'><strong> Bitesize </strong> bugs matching <strong> music player </strong> (22)</a></li> <li><a href='#'>Requests for <strong> documentation writing/editing</strong> (318)</a></li>
            </ul>
            {% endif %}
        </div>
    </div>
</div>

<div id='right' class='column'>

    <div class='module' id='meta'>
        <div class='head'>
            <h3>
                <a style='color: inherit;' href='/blog/'>
                    OpenHatch news
                </a>
            </h3> 
            <a class='blog-feed' title='RSS feed' href='/blog/feed/'>
                <span class='alt-text'>RSS feed</span>
            </a>
        </div>
        <div class='body'>
            <ul>
                {% for entry in entries %}
                <li>
                <a style='font-weight: bold;' href="{{ entry.link }}">{{ entry.title }}</a>
                <div class='byline'>by {{ entry.author }} &bull; {{ entry.published_parsed|timesince_terse }} ago</div>
                <div class="entry">
                    {{ entry.unicode_text|truncatewords:15 }}
                </div>
                </li>
                {% endfor %}
            </ul>
            <a style='float: right;' href='/blog/'>Get the whole blog &raquo;</a>
        </div>
    </div>

    {% if the_user.is_authenticated %}
    <div class='module'>
        <div class='head'>
            <h3><a href='/account/settings/widget/'>Widgetize yourself &rarr;</a></h3>
        </div>
    </div>
    {% endif %}

</div>
{% endblock content %}
