{% extends 'search/base.html' %}

{% block title %}
Search bugs 
{{ block.super }}
{% endblock title %}

{% block css %}
{{ block.super }}
{% if not bunch_of_bugs %}
#results-sidebar {
    display: none;
}
{% endif %}
{% endblock css %}

{% block pagetop %}
<h3><img alt='Volunteer opportunities' id='volunteer-opportunities' alt='Volunteer opportunities' src='/static/images/volunteer-opportunities-full.png' /></h3>
{% endblock pagetop %}

{% block sidebar %}
<div id='filters' class='box module'>
    <h4 style='margin-bottom: 10px;'>
        Browse by&hellip;
    </h4>
    <ul id='facets'>
        {% for facet_name, value2count in all_facets.items %}
        {% comment %}
        facets = e.g. {
        'Language': {
        'Python': 1,
        'Java': 8,
        }
        }
        {% endcomment %}
        <li>
        {% ifequal facet_name 'Language' %}
        Main project language 
        {% else %}
        {{ facet_name }}
        {% endifequal %}
        <ul>
            {% for value, count in value2count.items %}
            {% if value %}
            <li><a href='?q={{ q|urlencode }}&{{facet_name|urlencode}}={{value|urlencode}}'>
                {{ value }} ({{ count }})
            </a></li>
            {% endif %}
            {% endfor %}
        </ul>
        </li>
        {% endfor %}
    </ul>
    {% if the_user.is_authenticated %}
    {% if suggestions %}
    <h4>
        Recommended searches
    </h4>
    <form name='suggested_searches'
        id='suggested_searches'
        method='GET' action=''>
        <ul>
            {% for index, term, czeched in suggestions %}
            <li>
            <input id='term_{{ index }}' name='term_{{ index }}' type='checkbox'
            {% if czeched %}checked='on'{% endif %} %} />
            <label for='term_{{ index }}'>{{ term }}</label>
            </li>
            {% endfor %}
        </ul>
        <a id='toggle-more-suggestions' href='#'>
            Show <span>more</span> suggestions
        </a>
        <input type='submit' value='Find bugs'/>
    </form>
    {% else %}
        <a href='{% url mysite.profile.views.portfolio_editor %}'>
            <strong>List some projects in your portfolio</strong> to receive recommendations.
        </a>
    {% endif %}
    {% else %}
    <ul>
        <li>
        <a href='/account/login'>
            <strong>Log in / sign up</strong> to see recommendations.
        </a>
        </li>
    </ul>
    {% endif %}
</div>
{% endblock sidebar %}

{% block main %}
<div id='results' class='gewgaws module box results'>
    <div id='opps'>
        {% comment %}
        {
            'Language': 'Python',
        }
        {% endcomment %}
        <form name='search_opps' method='get'> 
            <input type='text'
            name='q' id='q'
            class='default-text'
            title='Search bugs by language, project or full text'
            value='{{ q }}' />

            {% for facet, value in active_facets.items %}
            <input type='hidden' name='{{facet}}' value='{{value}}' />
            {% endfor %}
            <input type='submit' id='button' value='Search' />
        </form>

        {% include 'search/results_widget.html' %}

        {% include 'search/results_sidebar.html' %}

        {% if bunch_of_bugs %}
        <ul>
            {% for bug in bunch_of_bugs %}
            <li class='bug {% cycle "even" "odd"%}'>
            {% include 'search/result.html' %}
            </li>
            {% endfor %}
        </ul>
        {% else %}

        {% endif %}

    </div> <!-- /#results -->
</div> <!-- /#opps -->
{% endblock main %}
{% block js %}
<style>
    #result-template {
        display: none;
    }
</style>
<li class='bug' id='result-template'>
{# Javascript uses this HTML to regenerate the results list. #}
{% include 'search/result.html' %}
</li>
{{ block.super }}
<script src='/static/js/search/defaultText.js'></script>
<script src='/static/js/search/suggestions.js'></script>
{% comment %}
<script src='/static/js/search/testData.js'></script>
<script src='/static/js/search/tests.js'></script>
{% endcomment %}
{% endblock js %}
