{% extends 'base/two_columns.html' %}
{% load voting_tags %}
{% votes_by_user the_user on link_list as vote_dict %}
{% scores_for_objects link_list as score_dict %}

{% block title %}
Projects - {{ project.name }} 
{% endblock title %}

{% block body_id %}project{% endblock body_id %}

{% block description_for_anonymous_users %}
<strong>Learn below</strong>
about our members who support {{ project.name }}
{% endblock %}

{% block pagetop %}

    <h3 class='supertitle'><a href='{% url mysite.project.views.projects %}'>Projects</a></h3>
    <h1>{{ project.name }}</h1>

{% endblock pagetop %}

{% block left %}
    <div class='module contains_questions'>
        <div class='head'>
            <h3>Discuss {{ project.name }}</h3>
        </div>
        <div class='body'>
            <ul id='paragraph_questions' class='questions'>
                {% for question, answers in question2answer %}
                    <li>
                        <h3><strong>Q:</strong>
                            {% ifequal question.key_string 'non_code_participation' %}
                                Other than writing code, how can people participate
                                in {{ project.name }}?
                            {% endifequal %}

                            {% ifequal question.key_string 'where_to_start' %}
                                I'm interested in getting involved in
                                {{ project.name }}. Where do I start?
                            {% endifequal %}
                            {% ifequal question.key_string 'stress' %}
                                What is a bug or issue with {{ project.name }} that
                                you've been putting off that is stressing you out?
                            {% endifequal %}
                            {% ifequal question.key_string 'newcomers' %}
                                What is a good issue for a newcomer to start out with?
                            {% endifequal %}
                        </h3>
                        <ul class='answers'>
                            {% for answer in answers %}
                            {% dict_entry_for_item answer from vote_dict as vote %}
                            {% vote_by_user the_user on answer as vote %}
                            {% score_for_object answer as score %}
                            <li>
                            <span class="voting">
                                <form class="answervote" id="answerup{{ answer.pk }}" action="/+answer/vote/{{ answer.id }}/{% if vote and vote.is_upvote %}clear{% else %}up{% endif %}vote/" method="POST">
                                    <input type="image" id="answeruparrow{{ answer.id }}" src="/static/images/go-up{% if vote and vote.is_upvote %}{% else %}-off{% endif %}.png" >
                                    <input type="hidden" name="next" value="{{project.get_url}}">
                                </form>
                                <div class='score'>{{ score.score|default:0 }}</div>

                                <form class="answervote" id="answerdown{{ answer.id }}" action="/+answer/vote/{{ answer.id }}/{% if vote and vote.is_downvote %}clear{% else %}down{% endif %}vote/" method="POST">
                                    <input type="image" id="answerdownarrow{{ answer.id }}" src="/static/images/go-down{% if vote and vote.is_downvote %}{% else %}-off{% endif %}.png">
                                    <input type="hidden" name="next" value="{{project.get_url}}">
                                </form>
                            </span>
                            {% if not question.is_bug_style %}

                                {% ifequal the_user answer.author %}
                                {% with 1 as edit_form %}
                                {% include 'project/forms/paragraph.html' %}
                                {% endwith %}
                                {% endifequal %}

                                <span class="answer" id="answer_{{answer.pk}}">
                                    {{ answer.text|urlize }}
                                    <br/>
                                    {% include 'project/byline.html' %}
                                </span>

                            {% else %}

                                {% ifequal the_user answer.author %}
                                {% with 1 as edit_form %}
                                {% include 'project/forms/bug.html' %}
                                {% endwith %}
                                {% endifequal %}
                                <span class="answer" id="answer_{{answer.pk}}">
                        
                                    <div class="bug_answer_title">
                                        {% ifequal the_user answer.author %}
                                        {% endifequal %}
                                        <strong>{{answer.title}}</strong>
                                    </div>
                                    {{answer.text|urlize}}
                                    <br/>
                                    {% include 'project/byline.html' %}
                                </span>

                            {% endif %}

                        </span>
                        {% endfor %}

                            <li>
                            {% if the_user.is_authenticated %}
                            {% if question.is_bug_style %}
                            {% include 'project/forms/bug.html' %}
                            {% else %}
                            {% include 'project/forms/paragraph.html' %}
                            {% endif %}
                            {% else %}
                            {# if they aren't logged in#}
                            <a href="{% url oh_login %}?next={{ project.get_url|urlencode}}" style="">Log in to add an answer</a>
                            {% endif %}

                            </li>
                            </ul>
                            </li>
                            {% endfor %}
                        </ul>
    </div>
</div><!-- /.module #requests -->

{% endblock left %}

{% block main %}
    <div class='module' id='bugs'>
        <div class='head'>
            <h3>Relatedly</h3>
        </div>
        <div class='body'>
            {% if project.get_open_bugs %}
                <p>
                    Browse {{ project.get_open_bugs|length }}+
                    <a href='/search/?q={{ project.name_with_quotes_if_necessary|urlencode }}'>
                        volunteer opportunit{{ project.get_open_bugs|pluralize:"y,ies"}}
                        matching
                        <strong>{{ project.name }}</strong>.
                    </a>
            {% else %}
                No volunteer opportunities in {{project.name}} indexed here yet. 
                <a href='/wiki/Bug_trackers'>
                    To add a bug tracker, 
                    visit our wiki</a>.

            </p>
        {% endif %}
      
      {% with mentors as mentors %}
      {% with project.name as topic %}
      {% with 0 as explain_language %}
      {% include 'project/mentor_summary.html' %}
      {% endwith %}
      {% endwith %}
      {% endwith %}

      {% if project.language %}
      {% with language_mentors as mentors %}
      {% with project.language as topic %}
      {% with 1 as explain_language %}
      {% include 'project/mentor_summary.html' %}
      {% endwith %}
      {% endwith %}
      {% endwith %}
      {% endif %}

    </div>
</div><!-- /.module #bugs -->

<div class='module' id='contributors'>
    <div class='head'>
        <h3>Registered contributors ({% firstof project.cached_contributor_count "none yet" %})</h3>
            <ul>
                <li>
                <a href='{% url mysite.profile.views.people %}?q=project:"{{project.name|urlencode}}"' style='float: right; font-weight: normal;'>See all <strong>&raquo;</strong></a>
                </li>
            </ul>
    </div>
    <div class='body'>
        <ul id='people-list'>
            {% for person in contributors %}
                {% include 'profile/person-summary-li.html' %}
            {% empty %}
                No registered contributors yet.  
            {% endfor %}
        </ul>
        <div style='width: 100%; float: left; text-align: right; margin-top: 20px; font-size: 8pt;'>
        To be listed here,
            <a href='{% url mysite.profile.views.portfolio_editor %}'>
                add {{ project.name }} to your
                profile</a>.
        </div>
    </div>
</div>

{% endblock main %}

{% block js %}
    <script type='text/javascript'>
        $(function() {
            $('.add_an_answer')
                .focus(function() {
                    $form = $(this).parent();
                    $form.addClass('active');
                    $form.find('input:text, textarea').unbind('blur');
                });

            $('input:text, textarea').hint();
            // Bind a function to the 'x' on input forms.  this function collapses the form
            $('.collapse_answer_form').click(function(){
                $form = $(this).parent().parent();
                $form.removeClass('active');
                $form.find('input:text, textarea').hint();
                if($form.hasClass('is_edit_form')){
                    answer_id = $(this).attr('id').split('_')[3];
                    console.debug(answer_id);
                    $answer = $("#answer_" + answer_id);
                    $answer.show();
                    $delete_form = $("#delete_form_" + answer_id);
                    $delete_form.show();
                    $edit_link = $("#edit_link_"  + answer_id);
                    $edit_link.show();
                }
                return false;
            });
            $('.edit_link').click(function(){
                answer_id = this.id.split('_')[2];
                $form = $("#edit_form_"  + answer_id);
                $form.addClass('active');
                $form.find('input:text, textarea').unbind('blur');
                $answer = $("#answer_"  + answer_id);
                $answer.hide();
                $delete_form = $("#delete_form_"  + answer_id);
                $delete_form.hide();
                $(this).hide();
                $form.find('input:text, textarea').focus();
                return false;
            });
        })
    </script>

{% endblock js %}

{% comment %}
vim: set ai et ts=4 sw=4 nu:
{% endcomment %}
